<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pastelería Mil Sabores</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Montserrat:wght@500;600;700&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="/css/style.css">
</head>

<body class="d-flex flex-column min-vh-100">
    <!-- HEADER GLOBAL DE INDEX.HTML -->
    <header class="sticky-top">
        <nav class="navbar navbar-expand-lg primary-nav">
            <div class="container">
                <a class="navbar-brand" href="index.html">
                    <img src="/img/logos/logo_titulo.png" alt="Pastelería Mil Sabores" class="brand-logo" />
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav mx-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/pages/categorias.html" id="navbarDropdown">
                                Productos
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                                <li><a class="dropdown-item" href="productos.html?filtro=todosBtn">Todos</a></li>
                                <li><a class="dropdown-item" href="productos.html?filtro=tortasCuadradasBtn">Tortas Cuadradas</a></li>
                                <li><a class="dropdown-item" href="productos.html?filtro=tortasCircularesBtn">Tortas Circulares</a></li>
                                <li><a class="dropdown-item" href="productos.html?filtro=postresIndividualesBtn">Postres Individuales</a></li>
                                <li><a class="dropdown-item" href="productos.html?filtro=sinAzucarBtn">Productos Sin Azúcar</a></li>
                                <li><a class="dropdown-item" href="productos.html?filtro=pasteleriaTradicionalBtn">Pastelería Tradicional</a></li>
                                <li><a class="dropdown-item" href="productos.html?filtro=sinGlutenBtn">Productos sin gluten</a></li>
                                <li><a class="dropdown-item" href="productos.html?filtro=veganosBtn">Productos Veganos</a></li>
                                <li><a class="dropdown-item" href="productos.html?filtro=tortasEspecialesBtn">Tortas Especiales</a></li>
                            </ul>
                        </li>
                        <li class="nav-item"><a class="nav-link" href="/pages/nosotros.html">Nosotros</a></li>
                        <li class="nav-item"><a class="nav-link" href="/pages/blogs.html">Blogs</a></li>
                        <li class="nav-item"><a class="nav-link" href="/pages/contacto.html">Contacto</a></li>
                    </ul>
                    <div class="d-flex align-items-center">
                        <div class="nav-item dropdown account-dropdown ms-3">
                            <a class="nav-link" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="bi bi-person-circle fs-4"></i>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end" id="account-menu">
                            </ul>
                        </div>
                        <a href="carrito.html" class="nav-link ms-3 position-relative" style="margin-right: 16px;">
                            <i class="bi bi-cart fs-4"></i>
                            <span id="cart-count" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger d-none">0</span>
                        </a>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <!-- HERO -->
    <section class="hero-blog">
        <div class="container">
            <h1 class="display-5 fw-bold mb-2">Blog • Recetas & Impacto Comunitario</h1>
            <p class="lead mb-0">Ideas dulces cada semana y cómo tu compra apoya a estudiantes de gastronomía y a la
                comunidad.</p>
        </div>
    </section>

    <main>
        <!-- IMPACTO COMUNITARIO -->
        <section class="py-5">
            <div class="container">
                <div class="mb-4 section-title">
                    <h2 class="h3 fw-bold mb-1">Impacto Comunitario <span class="bar"></span></h2>
                    <p class="text-secondary mb-0">Escuela de Administración y Negocios • Cómo tus compras apoyan a
                        estudiantes de gastronomía y al entorno local.</p>
                </div>

                <div class="row g-4">
                    <div class="col-lg-6">
                        <div class="card shadow-sm h-100">
                            <div class="card-body p-4">
                                <div class="d-flex align-items-center gap-3 mb-3">
                                    <i class="bi bi-mortarboard fs-2 text-primary"></i>
                                    <h3 class="h5 mb-0">Becas y prácticas formativas</h3>
                                </div>
                                <p class="mb-0">
                                    Un porcentaje de cada compra se destina a <strong>becas y materiales</strong> para
                                    estudiantes de gastronomía.
                                    Además, mantenemos un programa de <strong>prácticas supervisadas</strong> donde
                                    participan en producción real,
                                    gestión de inventario y control de calidad, aplicando lo aprendido en clases con
                                    estándares profesionales.
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-6">
                        <div class="card shadow-sm h-100">
                            <div class="card-body p-4">
                                <div class="d-flex align-items-center gap-3 mb-3">
                                    <i class="bi bi-people fs-2 text-primary"></i>
                                    <h3 class="h5 mb-0">Desarrollo local y encadenamiento</h3>
                                </div>
                                <p class="mb-0">
                                    Priorizamos <strong>proveedores locales</strong> y talleres asociados a la Escuela
                                    de Administración y Negocios.
                                    Esto genera oportunidades, fomenta el <strong>emprendimiento</strong> y fortalece
                                    redes entre estudiantes,
                                    egresados y negocios de barrio, aportando al crecimiento sostenible de la comunidad.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div  id="recetas" class="alert alert-primary mt-4 mb-0" role="alert">
                    <i class="bi bi-info-circle me-2"></i>
                    ¿Eres estudiante de gastronomía? Escríbenos en <a href="contacto.html"
                        class="alert-link">Contacto</a> para conocer cupos de práctica y beneficios.
                </div>
            </div>
        </section>

        <!-- RECETAS DE LA SEMANA -->
        <section class="py-5 bg-light">
            <div class="container">
                <div class="mb-4 section-title">
                    <h2  class="h3 fw-bold mb-1">Recetas de la semana <span class="bar"></span></h2>
                    <p class="text-secondary mb-0">Tres recetas simples, diferentes cada semana. ¡Manos a la obra!</p>
                </div>

                <div class="row g-4">
                    <!-- Receta 1 -->
                    <div class="col-md-4">
                        <article class="card h-100 shadow-sm recetas-card">
                            <img src="/img/Blog/cheesecake_sin_horno.jpg" class="card-img-top" alt="Cheesecake clásico">
                            <div class="card-body">
                                <span class="badge text-bg-warning mb-2">Sin horno</span>
                                <h3 class="h5">Cheesecake clásico sin horno</h3>
                                <p class="text-secondary mb-3">Base de galleta, relleno cremoso y topping de frutas. 20
                                    min + frío.</p>
                                <a href="recetas.html?receta=cheesecake" class="btn btn-outline-primary btn-sm">Ver receta</a>
                            </div>
                        </article>
                    </div>

                    <!-- Receta 2 -->
                    <div class="col-md-4">
                        <article class="card h-100 shadow-sm recetas-card">
                            <img src="/img/Blog/Brownies.jpg" class="card-img-top"
                                alt="Brownies húmedos">
                            <div class="card-body">
                                <span class="badge text-bg-success mb-2">Económica</span>
                                <h3 class="h5">Brownies húmedos en 1 bowl</h3>
                                <p class="text-secondary mb-3">Textura fudge, cacao intenso y pocos ingredientes. 30
                                    minutos.</p>
                                <a href="recetas.html?receta=brownies" class="btn btn-outline-primary btn-sm">Ver receta</a>
                            </div>
                        </article>
                    </div>

                    <!-- Receta 3 -->
                    <div class="col-md-4">
                        <article class="card h-100 shadow-sm recetas-card">
                            <img src="/img/Blog/Tiramisu.jpg" class="card-img-top" alt="Tiramisú casero">
                            <div class="card-body">
                                <span class="badge text-bg-primary mb-2">Avanzado</span>
                                <h3 class="h5">Tiramisú casero</h3>
                                <p class="text-secondary mb-3">Capas de bizcotelas, café y crema suave. Montaje en 15
                                    minutos.</p>
                                <a href="recetas.html?receta=tiramisu" class="btn btn-outline-primary btn-sm">Ver receta</a>
                            </div>
                        </article>
                    </div>
                </div>

                <!-- Chat comunidad -->
                <div class="mt-5">
                    <h3 class="h4 mb-3">Habla con la comunidad</h3>
                    <div id="chat-comunidad" class="card p-3 mb-3" style="max-height: 340px; overflow-y: auto;"></div>
                    <button id="btn-ver-mas-chat" class="btn btn-outline-primary d-none">Seguir leyendo</button>
                    <form id="chat-form" class="mt-3">
                        <div class="input-group align-items-center">
                            <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="chat-categoria-btn" data-bs-toggle="dropdown" aria-expanded="false">Categoría</button>
                            <ul class="dropdown-menu" id="chat-categoria-menu" aria-labelledby="chat-categoria-btn">
                                <li><a class="dropdown-item" href="#" data-value="Recetas">Recetas</a></li>
                                <li><a class="dropdown-item" href="#" data-value="General">General</a></li>
                                <li><a class="dropdown-item" href="#" data-value="Otros">Otros</a></li>
                            </ul>
                            <input type="hidden" id="chat-categoria" value="Recetas">
                            <input type="text" id="chat-input" class="form-control" placeholder="Escribe tu mensaje..." maxlength="120" required>
                            <button class="btn btn-primary" type="submit">Enviar</button>
                            <span id="chat-palabras-contador" class="ms-2 text-secondary small" style="min-width:70px;text-align:right;">0/30</span>
                        </div>
                        <div id="chat-palabras-alert" class="form-text text-danger d-none">El mensaje no puede tener más de 30 palabras.</div>
                        <div id="chat-receta-select" class="mt-2" style="display:none;">
                            <select id="chat-receta" class="form-select form-select-sm">
                                <option value="">Selecciona una receta…</option>
                                <option value="Cheesecake clásico">Cheesecake clásico</option>
                                <option value="Brownies húmedos en 1 bowl">Brownies húmedos en 1 bowl</option>
                                <option value="Tiramisú casero">Tiramisú casero</option>
                            </select>
                            <div id="chat-receta-alert" class="form-text text-danger d-none">Debes seleccionar una receta.</div>
                        </div>
                        <div id="chat-login-alert" class="form-text text-danger d-none">Debes iniciar sesión para escribir en el chat.</div>
                    </form>
                </div>
            </div>
        </section>

        <!-- Modal Chat Comunidad -->
        <div class="modal fade" id="chatModal" tabindex="-1" aria-labelledby="chatModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content border-0 shadow-lg rounded-4">
                    <div class="modal-header border-0">
                        <h5 class="modal-title" id="chatModalLabel">Mensajes de la comunidad</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                    </div>
                    <div class="modal-body pt-0" id="chat-modal-body" style="max-height: 400px; overflow-y: auto;"></div>
                </div>
            </div>
        </div>

        <!-- NOTICIAS (Carrusel + textos al lado) -->
        <section class="py-5">
            <div class="container">
                <div class="mb-4 section-title">
                    <h2 class="h3 fw-bold mb-1">Noticias y novedades <span class="bar"></span></h2>
                    <p class="text-secondary mb-0">Actividades, talleres, campañas solidarias y más.</p>
                </div>

                <div class="row g-4 align-items-start">
                    <!-- Carrusel -->
                    <div class="col-lg-7">
                        <div id="newsCarousel" class="carousel slide shadow-sm rounded overflow-hidden"
                            data-bs-ride="carousel">
                            <div class="carousel-inner ratio-16x9">
                                <div class="carousel-item active">
                                    <img src="/img/Blog/TallerdeDecoracion.jpg" class="d-block w-100" alt="Taller de decoración 1">
                                </div>
                                <div class="carousel-item">
                                    <img src="/img/Blog/Vitrina.jpg" class="d-block w-100" alt="Taller de decoración 2">
                                </div>
                                <div class="carousel-item">
                                    <img src="/img/Blog/ControlCalidad.jpg" class="d-block w-100"
                                        alt="Nueva vitrina de postres">
                                </div>
                                <div class="carousel-item">
                                    <img src="/img/Blog/Donacion.jpg" class="d-block w-100" alt="Campaña solidaria">
                                </div>
                                <div class="carousel-item">
                                    <img src="/img/Blog/Recetario.jpg" class="d-block w-100" alt="Recetario comunitario">
                                </div>
                            </div>
                            <button class="carousel-control-prev" type="button" data-bs-target="#newsCarousel"
                                data-bs-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Anterior</span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#newsCarousel"
                                data-bs-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Siguiente</span>
                            </button>
                            <div class="carousel-indicators">
                                <button type="button" data-bs-target="#newsCarousel" data-bs-slide-to="0" class="active"
                                    aria-current="true" aria-label="1"></button>
                                <button type="button" data-bs-target="#newsCarousel" data-bs-slide-to="1"
                                    aria-label="2"></button>
                                <button type="button" data-bs-target="#newsCarousel" data-bs-slide-to="2"
                                    aria-label="3"></button>
                                <button type="button" data-bs-target="#newsCarousel" data-bs-slide-to="3"
                                    aria-label="4"></button>
                                <button type="button" data-bs-target="#newsCarousel" data-bs-slide-to="4"
                                    aria-label="5"></button>
                            </div>
                        </div>
                    </div>

                    <!-- Texto al lado (sincronizado por índice) -->
                    <div class="col-lg-5 news-side">
                        <div class="list-group shadow-sm" id="newsList">
                            <a class="list-group-item list-group-item-action active" data-index="0">
                                <div class="d-flex w-100 justify-content-between">
                                    <h3 class="h6 mb-1">Taller de decoración • Nivel inicial</h3>
                                    <small class="text-secondary">Esta semana</small>
                                </div>
                                <p class="mb-1 text-secondary">Sesión gratuita para la comunidad, guiada por docentes y
                                    alumnos en práctica.</p>
                            </a>
                            <a class="list-group-item list-group-item-action" data-index="1">
                                <div class="d-flex w-100 justify-content-between">
                                    <h3 class="h6 mb-1">Abre la nueva vitrina de tortas</h3>
                                    <small class="text-secondary">Novedad</small>
                                </div>
                                <p class="mb-1 text-secondary">Más variedad diaria y vitrinas con control de temperatura
                                    eficiente.</p>
                            </a>
                            <a class="list-group-item list-group-item-action" data-index="2">
                                <div class="d-flex w-100 justify-content-between">
                                    <h3 class="h6 mb-1">Convocatoria a pasantías</h3>
                                    <small class="text-secondary">Académico</small>
                                </div>
                                <p class="mb-1 text-secondary">Postula a pasantías de 8 semanas en control de calidad y
                                    producción.</p>
                            </a>
                            <a class="list-group-item list-group-item-action" data-index="3">
                                <div class="d-flex w-100 justify-content-between">
                                    <h3 class="h6 mb-1">Campaña “Un dulce, una sonrisa”</h3>
                                    <small class="text-secondary">Comunidad</small>
                                </div>
                                <p class="mb-1 text-secondary">Por cada compra, donamos colaciones a organizaciones
                                    locales.</p>
                            </a>
                            <a class="list-group-item list-group-item-action" data-index="4">
                                <div class="d-flex w-100 justify-content-between">
                                    <h3 class="h6 mb-1">Recetario comunitario colaborativo</h3>
                                    <small class="text-secondary">Participa</small>
                                </div>
                                <p class="mb-1 text-secondary">Comparte tu receta favorita y participa por un kit de
                                    repostería.</p>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="container my-4">
            <h1 class="mb-4">Blog & Recetas</h1>
            <div id="lista-blogs" class="row g-4"></div>
        </section>


        <!-- AGRADECIMIENTOS A LA COMUNIDAD -->
        <section class="py-5 bg-light agradecimientos">
            <div class="container">
                <div class="mb-4 section-title">
                    <h2 class="h3 fw-bold mb-1">Agradecimientos a la comunidad <span class="bar"></span></h2>
                    <p class="text-secondary mb-0">Destacado de la semana y espacio para compartir tus creaciones.</p>
                </div>

                <!-- Destacado de la semana -->
                <div class="card shadow-sm mb-4">
                    <div class="card-body p-4">
                        <div class="d-flex align-items-center gap-3">
                            <img src="/img/Blog/Antonia.jpg" alt="Receta destacada" class="avatar">
                            <div class="flex-grow-1">
                                <h3 class="h6 mb-1">Destacado de la semana: <span class="fw-semibold">Antonia R.</span>
                                </h3>
                                <p class="text-secondary mb-2">Antonia preparó nuestro <em>Cheesecake clásico</em> y nos
                                    compartió su resultado.
                                    ¡Quedó increíble! 💛</p>
                                <a href="/pages/recetas.html?receta=cheesecake" class="btn btn-sm btn-primary">
                                    Ver receta <i class="bi bi-book"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Invitación a subir agradecimiento (placeholder sin backend) -->
                <div class="card shadow-sm">
                    <div class="card-body p-4">
                        <h3 class="h6 mb-3">¿Quieres aparecer aquí?</h3>
                        <form
                            onsubmit="event.preventDefault(); alert('Gracias por tu aporte. Pronto habilitaremos la subida de fotos.');">
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label class="form-label">Tu nombre</label>
                                    <input type="text" class="form-control" required>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Receta</label>
                                    <select class="form-select" required>
                                        <option value="">Selecciona…</option>
                                        <option>Cheesecake clásico</option>
                                        <option>Brownies 1 bowl</option>
                                        <option>Tiramisú casero</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Foto (opcional)</label>
                                    <input type="file" class="form-control" accept="image/*" disabled>
                                    <div class="form-text">Deshabilitado temporalmente.</div>
                                </div>
                                <div class="col-12 text-end">
                                    <button class="btn btn-outline-primary">Enviar agradecimiento</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

            </div>
        </section>
    </main>

    <div id="footer"></div>

    <!-- Modal Login -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg rounded-4"
                style="backdrop-filter: blur(6px); background: color-mix(in oklab, #ffffff 80%, transparent);">
                <div class="modal-header border-0">
                    <h5 class="modal-title" id="loginTitle">Iniciar sesión</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>

                <div class="modal-body pt-0">
                    <form id="loginForm" novalidate>
                        <div class="mb-3">
                            <label for="loginEmail" class="form-label">Correo</label>
                            <input type="email" class="form-control" id="loginEmail" placeholder="tu@correo.com"
                                required>
                            <div class="invalid-feedback">Ingresa un correo válido.</div>
                        </div>

                        <div class="mb-2">
                            <label for="loginPass" class="form-label">Contraseña</label>
                            <input type="password" class="form-control" id="loginPass" placeholder="********" required>
                            <div class="invalid-feedback">La contraseña es obligatoria.</div>
                        </div>

                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="rememberMe">
                                <label class="form-check-label" for="rememberMe">Recordarme</label>
                            </div>
                            <a href="#" class="small">¿Olvidaste tu contraseña?</a>
                        </div>

                        <button type="submit" class="btn btn-primary w-100">Entrar</button>
                    </form>

                    <p class="text-center small mt-3 mb-0">
                        ¿No tienes cuenta? <a href="registro.html">Regístrate</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/user_store.js"></script>
    <script src="/js/navbar_sesion.js"></script>
    <script src="/js/login.js"></script>
    <script src="/js/carrito.js"></script>
    <script src="/js/blogs.js" type="module"></script>
    <script src="/js/admin_access.js"></script>
    <script src="/js/footer.js"></script>
    <script>
    // Chat comunidad demo
function loadMensajesDemo() {
    const saved = localStorage.getItem('chatMensajes');
    let mensajes;
    if (saved) {
        try {
            mensajes = JSON.parse(saved);
        } catch (e) {}
    }
    if (!mensajes) {
        mensajes = [
            {nombre: 'Ana', texto: '¡Me encantó el cheesecake!', img: ''},
            {nombre: 'Luis', texto: '¿Alguien probó la receta de brownies?', img: ''},
            {nombre: 'Sofía', texto: 'Recomiendo usar cacao amargo.', img: ''},
            {nombre: 'Carlos', texto: '¿Dónde compran los ingredientes?', img: ''},
            {nombre: 'Valentina', texto: 'Suban más recetas veganas!', img: ''},
            {nombre: 'Pedro', texto: '¿Puedo compartir mi foto?', img: ''},
            {nombre: 'Marta', texto: 'El tiramisú quedó increíble.', img: ''},
            {nombre: 'Javier', texto: '¿Cuánto dura el cheesecake en la heladera?', img: ''},
            {nombre: 'Camila', texto: 'Gracias por la receta!', img: ''},
            {nombre: 'Tomás', texto: '¿Alguien tiene receta de galletas?', img: ''},
        ];
    }
    // Asignar categoría por defecto si no existe
    mensajes.forEach(msg => {
        if (!msg.categoria) msg.categoria = 'General';
    });
    return mensajes;
}
let mensajesDemo = loadMensajesDemo();
function saveMensajesDemo() {
    localStorage.setItem('chatMensajes', JSON.stringify(mensajesDemo));
}
function getCategoriaBadgeClass(categoria) {
    if (categoria === 'Recetas') return 'bg-success';
    if (categoria === 'General') return 'bg-primary';
    return 'bg-secondary';
}
function renderChatPreview() {
    const chatDiv = document.getElementById('chat-comunidad');
    chatDiv.innerHTML = '';
    const maxPreview = 10;
    mensajesDemo.slice(0, maxPreview).forEach(msg => {
        const badgeClass = getCategoriaBadgeClass(msg.categoria);
        const cat = msg.categoria ? `<span class='badge ${badgeClass} me-1'>${msg.categoria}</span>` : '';
        const receta = (msg.categoria === 'Recetas' && msg.receta) ? `<span class='badge bg-warning text-dark me-1'>${msg.receta}</span>` : '';
        chatDiv.innerHTML += `<div class='mb-2'>${cat}${receta}<strong>${msg.nombre}:</strong> ${msg.texto} ${msg.img ? `<img src='${msg.img}' style='max-width:40px;max-height:40px;border-radius:6px;margin-left:6px;'>` : ''}</div>`;
    });
    const btnVerMas = document.getElementById('btn-ver-mas-chat');
    btnVerMas.classList.toggle('d-none', mensajesDemo.length <= 50);
}
function renderChatModal() {
    const modalBody = document.getElementById('chat-modal-body');
    modalBody.innerHTML = '';
    mensajesDemo.forEach(msg => {
        const badgeClass = getCategoriaBadgeClass(msg.categoria);
        const cat = msg.categoria ? `<span class='badge ${badgeClass} me-1'>${msg.categoria}</span>` : '';
        const receta = (msg.categoria === 'Recetas' && msg.receta) ? `<span class='badge bg-warning text-dark me-1'>${msg.receta}</span>` : '';
        modalBody.innerHTML += `<div class='mb-3'>${cat}${receta}<strong>${msg.nombre}:</strong> ${msg.texto} ${msg.img ? `<img src='${msg.img}' style='max-width:60px;max-height:60px;border-radius:8px;margin-left:8px;'>` : ''}</div>`;
    });
}
function isUserLoggedIn() {
        // Busca un usuario válido en localStorage
        for (let key in localStorage) {
            try {
                const user = JSON.parse(localStorage.getItem(key));
                if (user && user.nombre && user.correo) {
                    return true;
                }
            } catch (e) {}
        }
        return false;
    }
    function getUserName() {
        for (let key in localStorage) {
            try {
                const user = JSON.parse(localStorage.getItem(key));
                if (user && user.nombre && user.correo) {
                    return user.nombre;
                }
            } catch (e) {}
        }
        return 'Usuario';
    }
    function updateChatFormState() {
        const chatForm = document.getElementById('chat-form');
        const chatInput = document.getElementById('chat-input');
        const chatAlert = document.getElementById('chat-login-alert');
        if (!isUserLoggedIn()) {
            chatInput.disabled = true;
            chatForm.querySelector('button[type="submit"]').disabled = true;
            chatAlert.classList.remove('d-none');
        } else {
            chatInput.disabled = false;
            chatForm.querySelector('button[type="submit"]').disabled = false;
            chatAlert.classList.add('d-none');
        }
    }
    // Permite actualizar el chat desde otros scripts
    window.updateChatFormState = updateChatFormState;
    document.addEventListener('DOMContentLoaded', function () {
        renderChatPreview();
        document.getElementById('btn-ver-mas-chat').onclick = function() {
            renderChatModal();
            var chatModal = new bootstrap.Modal(document.getElementById('chatModal'));
            chatModal.show();
        };
        // Dropdown categoría
        const categoriaBtn = document.getElementById('chat-categoria-btn');
        const categoriaInput = document.getElementById('chat-categoria');
        const recetaSelectDiv = document.getElementById('chat-receta-select');
        const recetaSelect = document.getElementById('chat-receta');
        const recetaAlert = document.getElementById('chat-receta-alert');
        const palabrasAlert = document.getElementById('chat-palabras-alert');
        const palabrasContador = document.getElementById('chat-palabras-contador');
        function toggleRecetaSelect() {
            recetaSelectDiv.style.display = categoriaInput.value === 'Recetas' ? 'block' : 'none';
        }
        categoriaBtn.addEventListener('click', function() {
            // Actualiza el select al abrir el dropdown
            toggleRecetaSelect();
        });
        document.getElementById('chat-categoria-menu').addEventListener('click', function(e) {
            if (e.target.matches('.dropdown-item')) {
                e.preventDefault();
                e.stopPropagation();
                categoriaBtn.textContent = e.target.textContent;
                categoriaInput.value = e.target.getAttribute('data-value');
                toggleRecetaSelect();
            }
        });
        // Mostrar el select correctamente al cargar la página
        // Seleccionar automáticamente la categoría 'Recetas' al cargar la página
    categoriaInput.value = 'Recetas';
    categoriaBtn.textContent = 'Recetas';
    toggleRecetaSelect();
        updateChatFormState();
        document.getElementById('chat-form').onsubmit = function(e) {
            e.preventDefault();
            if (!isUserLoggedIn()) return;
            const nombre = getUserName();
            const texto = document.getElementById('chat-input').value.trim();
            const categoria = categoriaInput.value;
            const receta = categoria === 'Recetas' ? recetaSelect.value : '';
            const palabras = texto.split(/\s+/).filter(Boolean);
            if (palabras.length > 30) {
                palabrasAlert.classList.remove('d-none');
                document.getElementById('chat-input').classList.add('is-invalid');
                return;
            } else {
                palabrasAlert.classList.add('d-none');
                document.getElementById('chat-input').classList.remove('is-invalid');
            }
            if (categoria === 'Recetas' && !receta) {
                recetaAlert.classList.remove('d-none');
                recetaSelect.classList.add('is-invalid');
                return;
            } else {
                recetaAlert.classList.add('d-none');
                recetaSelect.classList.remove('is-invalid');
            }
            if (texto) {
                mensajesDemo.unshift({nombre, texto, categoria, receta, img: ''});
                if (mensajesDemo.length > 30) {
                    mensajesDemo.pop();
                }
                saveMensajesDemo();
                renderChatPreview();
                document.getElementById('chat-input').value = '';
                if (categoria === 'Recetas') recetaSelect.value = '';
            }
        };
        const actualizarContadorPalabras = () => {
            const texto = document.getElementById('chat-input').value.trim();
            const palabras = texto.split(/\s+/).filter(Boolean);
            palabrasContador.textContent = `${palabras.length}/30`;
        };
        document.getElementById('chat-input').addEventListener('input', function() {
            actualizarContadorPalabras();
            const palabras = this.value.trim().split(/\s+/).filter(Boolean);
            if (palabras.length <= 30) {
                palabrasAlert.classList.add('d-none');
                this.classList.remove('is-invalid');
            }
        });
        actualizarContadorPalabras();
    });
    window.addEventListener('storage', function() {
        updateChatFormState();
    });
    </script>

    <!-- Sincronización carrusel y lista de noticias -->
    <script>
    document.addEventListener('DOMContentLoaded', function () {
        const carousel = document.getElementById('newsCarousel');
        const newsList = document.getElementById('newsList');
        if (!carousel || !newsList) return;

        const bsCarousel = bootstrap.Carousel.getOrCreateInstance(carousel);
        const items = Array.from(newsList.querySelectorAll('.list-group-item'));

        // Al hacer click en una noticia, mover el carrusel
        items.forEach(item => {
            item.addEventListener('click', function () {
                const idx = Number(item.getAttribute('data-index'));
                bsCarousel.to(idx);
            });
        });

        // Al cambiar el carrusel, activar la noticia correspondiente
        carousel.addEventListener('slide.bs.carousel', function (e) {
            const idx = e.to;
            items.forEach((item, i) => {
                item.classList.toggle('active', i === idx);
            });
        });
    });
    </script>
</body>

</html>